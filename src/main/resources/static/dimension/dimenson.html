<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>维度维护</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/static/layuiadmin/style/admin.css" media="all">
</head>
<style>
    body, html {
        height: 100%;
    }

    #dimlayout {
        height: calc(100% - 10px);
    }

    .layrow, .layui-card {
        height: calc(100% - 5px);
    }

    #dimlayout {
        padding: 10px 10px 0px 10px;

    }

    .hide {
        display: none;
    }
</style>
<body>
<div id="dimlayout">
    <div class="layui-row layui-col-space10 layrow">
        <div class=" layui-col-md3 layrow" id="left">
            <!-- 填充内容 -->
            <div class="layui-card">
                <div class="layui-row">
                    <div class="layui-elem-quote layui-quote-nm">
                        <strong>维度信息</strong>
                        <div class="layui-btn-group">
                            <button type="button" id="add" class="layui-btn layui-btn-primary layui-btn-sm">
                                <i class="layui-icon">&#xe654;</i>
                            </button>
                            <button type="button" id="edit" class="layui-btn layui-btn-primary layui-btn-sm">
                                <i class="layui-icon">&#xe642;</i>
                            </button>
                            <button type="button" id="del" class="layui-btn layui-btn-primary layui-btn-sm">
                                <i class="layui-icon">&#xe640;</i>
                            </button>
                            <button type="button" id="attr" class="layui-btn layui-btn-primary layui-btn-sm">
                                <i class="layui-icon">&#xe641;</i>
                            </button>
                        </div>

                    </div>
                </div>
                <div class="layui-row">
                    <form class="layui-form" id="dimform">

                    </form>
                </div>
            </div>
        </div>
        <div class=" layui-col-md9 layrow" id="right">
            <div class="layui-card">
                <div class="layui-row">
                    <div class="layui-elem-quote layui-quote-nm">
                        <a href="javascript:;" title="侧边伸缩">
                            <i class="layui-icon layui-icon-shrink-right" id="tabclick"></i>
                        </a>
                        <strong>成员信息</strong>
                    </div>
                </div>
            </div>
        </div>


    </div>

</div>

<script src="/static/layuiadmin/layui/layui.js"></script>
<script src="/static/common/utils.js"></script>
<script>
    layui.config({
        base: '/static/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'jquery', 'layer', 'form', 'element'], function () {
        $ = layui.$, layer = layui.layer, form = layui.form;
        $('#tabclick').click(function () {
            $(this).toggleClass('layui-icon-shrink-right layui-icon-spread-left');
            $('#left').toggleClass('hide');
            $('#right').toggleClass('layui-col-md9 layui-col-md12');
        })
        $('button').click(function () {
            var id = $(this).attr('id');
            btnevent[id]();
        });
        //渲染
        reloadDimList();
        bindDimSwich();
    });

    var btnevent = {
        add: function () {
            showPrompt('输入维度名称', function (name) {
                var member = {
                    name: name,
                    code: name
                };
                fetchPost("/member/addDim", member, reloadDimList);
            });
        },
        edit: function () {
            var id = this.getDimid();
            if (id) {
                fetchGet("/member/detail?id="+id, function (data) {
                    openContentDialog("修改维度", 100, 200, btnevent.initDetail(data), function () {
                        var editname = $('#editid').val();
                        fetchPost("/member/updateDim",{id:id, name: editname},reloadDimList)
                    });
                });

            }
        },
        initDetail: function (data) { //拼接维度信息
           var content = '<div class="layui-form-item">' +
                '<label class="layui-form-label">名称</label>' +
                '<input type="text" id="editid" class="layui-layer-input" value="' + data.name + '">' +
                '</div>' +
                '<div class="layui-form-item">' +
                '<label class="layui-form-label">编码</label>' +
                '<input type="text" class="layui-layer-input" disabled value="' + data.code + '">' +
                '</div>';

            return content;

        },
        del: function () {
            var id = this.getDimid();
            if (id) {
                showConfirm("提示", "确定删除么?", function () {
                    fetchPost("/member/delDim", {dimid: id}, reloadDimList);
                });
            }
        },
        attr: function () {
            var id = this.getDimid();
            if (id) {

            }
        },
        getDimid: function () {
            if (!dimid) {
                msgWarn("请先选择一个维度");
                return;
            }
            return dimid;
        }
    }
    var dimid;
    var reloadDimList = function () {
        $('#dimform').empty();
        fetchGet("/member/listDim", function (data) {
            data.forEach((item, index, array) => {
                var check = item.datatype == 6 ? 'checked' : '';
                $('#dimform').append(' <div class="layui-row"> ' +
                    '<div class=" layui-col-md8" ><label dimid = "' + item.id + '" style="font-size: 14px;font-weight: bold;width: auto"\n' +
                    '                   class="layui-form-label dimlabel">' + item.name + '</label> </div> \n' +
                    ' <div class=" layui-col-md2">  <input type="checkbox"   dimid="' + item.id + '" lay-skin="switch" lay-text="卷积|平面" lay-filter="rollup" ' + check + '></div></div>');
            })
            form.render();
        });

    }

    //表单切换绑定事件
    var bindDimSwich = function () {
        form.on('switch(rollup)', function (data) {
            var dimid = $(data.elem).attr('dimid');
            var datatype = this.checked ? 6 : 7;
            fetchPost("/member/switchDim", {dimid: dimid, datatype: datatype});
        });
        $(document).on("click", ".dimlabel", function () {
            $('.dimlabel').removeClass("custom-tree-item-clicked");
            $(this).addClass("custom-tree-item-clicked");
            dimid = $(this).attr('dimid');
        });

    };
</script>
</body>
</html>